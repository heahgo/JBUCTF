from pwn import *
from base64 import b64encode, b64decode

p = remote('172.17.0.2', 10003)

p.sendafter(b'>> ', b'1\n')
c1 = b64decode(p.recvline()[5:-1])
c2 = b64decode(p.recvline()[5:-1])
p.sendafter(b'>> ', b'2\n')
c3 = b64decode(p.recvline()[13:-1])

t1 = c1[-16:]
t2 = c2[-16:]
c1 = c1[:-16]
c2 = c2[:-16]

print(f'c1 = \'{c1.hex()}\'') 
print(f't1 = \'{t1.hex()}\'') 
print(f'c2 = \'{c2.hex()}\'') 
print(f't2 = \'{t2.hex()}\'') 
print(f'c3 = \'{c3.hex()}\'')

tags = input('tags : ')
tags = list(tags.split(' '))

for tag in tags:
    tag = bytes.fromhex(tag.zfill(16*2))
    edata = b64encode(c3 + tag)
    p.sendafter(b'>> ', b'3\n')
    p.sendafter(b'edata : ', edata + b'\n')
    result = p.recvline()[:-1]
    if result != b'Failed':
        print(result.decode())
        exit()